package cla.edg.project.yourong;

import cla.edg.pageflow.BasePageFlowDescriptionScript;
import cla.edg.pageflow.BasePageFlowScript;
import cla.edg.pageflow.PageFlowScript;

public class UnifyClientService extends BasePageFlowDescriptionScript {

	private static final PageFlowScript SCRIPT = $("unify client service").need_login().has_footprint()
		/** 查询定义 */
		.query("homepage_slide").which("merchant type").no_pagination().with_string("merchant type id")
			.comments("根据用户的merchant type来查询首页上的slide")
		.query("article").which("put in home page").no_pagination().with_string("merchant type id")
			.comments("根据用户的merchant type来查询首页上的article")
		/** 项目相关的查询 */
		
		.query("project").which("need handled by me").no_pagination().with_string("assignment id").with_string("owner type").with_integer("top n")
			.comments("查询当前用户需要尽快处理的项目")
			.rule_comments("根据指定的employee_nomination来确定")
			.rule_comments("如果是业主,所有未完结的项目都满足条件")
			.rule_comments("如果是公司的admin,所有进行中的,除了质保任务以外work_package所在的项目都满足条件")
			.rule_comments("如果是公司的财务,不关心任何项目")
			.rule_comments("如果是公司的工人,包含任何未结束的, 指派给自己的任务,都满足条件")
		/** 订单相关的查询 */
		.query("main_order").which("need handled by me").pagination().with_string("owner type").with_integer("top n")
			.comments("查询当前用户需要尽快处理的订单")
			.rule_comments("根据指定的employee_nomination来确定")
			.rule_comments("如果是业主,所有待支付的订单")
			.rule_comments("如果是公司的admin,所有需要待确认收款的订单")
			.rule_comments("如果是公司的财务,,所有需要待确认收款的订单")
			.rule_comments("如果是公司的工人,不关心任何订单")
		/** 首页及登录 */
		.request("home page")
			.comments("打开首页.").has_footprint().no_login().can_refresh()
			.when("need select nomination").comments("因为账户原因(例如任职变动)需要重新选择角色")
				.got_page("working scenario selection").title("切换职务")
					.comments("选择以哪个任职项目进行工作")
			.when("is property owner").comments("用户作为 业主 访问")
				.got_page("home page for property owner").title("业主")
					.comments("业主 看到的首页内容")
			.when("is store employee").comments("用户作为 门店员工 访问")
				.got_page("home page for store employee").title("优荣平台")
					.comments("门店员工 看到的首页内容")
			.when("is partner employee").comments("用户作为 品牌方 访问")
				.got_page("home page for partner employee").title("品牌方")
					.comments("品牌方/服务商员工 看到的首页内容")
			.when("is service employee").comments("用户作为 服务商员工 访问")
				.got_page("home page for store employee").title("服务商")
					.comments("服务商 看到的首页内容")
			.when("is potential customer").comments("用户作为 潜在客户 访问")
				.got_page("home page for potential customer").title("优荣装修")
					.comments("潜在客户 看到的首页内容")
					.may_request("start to login")
		.request("start to login")
			.comments("去登录").no_footprint().no_login()
			.got_page("unify login")
				.comments("统一的登录页面")
				.may_request("unify login")
		.request("unify login").with_form("mobile login")
			.comments("统一登录").no_login().no_footprint()
			.got_page_same_as_request("home page")
		.request("logout")
			.comments("退出登录").need_login().no_footprint()
			.got_page_same_as_request("home page")
		.request("send verify code SMS").with_string("mobile").variable()
			.comments("发送短信验证码").no_login()
			.got_page("simple toast")
//		.request("start to choose nomination")
//			.comments("选择自己以哪个任职项工作")
//			.got_page("select employee nomination")
//				.may_request("switch employee nomination")
//		.request("switch employee nomination").with_string("employee nomination id")
//			.comments("切换当前工作身份")
//			.got_page_same_as_request("home page")
			
		.request("view article").with_string("article id")
			.comments("查看文章内容").no_login().has_footprint()
			.got_page("article detail")
			
		/**
		 * 其他查看请求
		 */
		.request("view all article")
			.comments("查看所有文章").no_login().has_footprint()
			.got_page("article list")
				.comments("文章列表")
				.may_request("view article")
		.request("view operating area").with_string("content id")
			.comments("查看运营领域介绍").no_login().has_footprint()
			.got_page("operating area detail")
				.comments("运营领域介绍的详情,基本上这个是临时方案, 后面再说具体此类内容的展示")
			
		/***
		 * 	业主端的 page-flow
		 ***/
		.in_page("home page for potential customer")
			.may_request("apply to be a property owner")
			.may_request("apply to start a new project")
			.may_request("apply to be partner")
//			.may_request("view article")
			
		.in_page("home page for property owner")
			.may_request("apply to start a new project")
//			.may_request("apply to be an user").comments("TODO: 暂不实现")
			.may_request("view profile")
			.may_request("view my project list")
//			.may_request("view my order list")
			.may_request("view my project application list")
			.may_request("start to select working scenario")
			
		/** 申请成为业主. 首期先不做这个. 业主自动注册 */
		.request("apply to be a property owner")
			.comments("申请成为一个业主").no_login().no_footprint()
			.got_page("property owner register form")
				.comments("业主申请表单的填写页面")
				.may_request("submit property owner application")
		.request("submit property owner application").with_string("user id")
			.comments("TODO: 这个方法首期不做, 后面根据业务需要再说").no_login().no_footprint()
			.got_page("home page for property owner")
			
		.request("apply to be partner")
			.comments("申请成为品牌方/供应商").no_login().no_footprint()
			.got_page("partner register form")
				.comments("品牌方申请表单的填写页面")
				.may_request("submit partner application")
		.request("submit partner application").with_form("partner_application")
			.comments("提交品牌方注册申请表单").no_login().no_footprint()
			.got_page("simple popup")
			
		/** 我的 页面 */
			
		.request("view profile")
			.comments("查看个人信息")
			
			.query("project").which("current merchant").pagination().with_string("filter").with_string("owner type").with_integer("top n")
				.comments("查询当前用户相关的项目")
				.rule_comments("filter 表示进行中/已关闭等")
				.rule_comments("owner type 表示 以业主身份查看/以服务商身份查看/以门店身份查看 等")
			.query("main_order").which("current merchant").pagination().with_string("filter").with_string("owner type").with_integer("top n")
				.comments("查询当前用户相关的项目")
				.rule_comments("filter 表示待支付/支付中/已支付等")
				.rule_comments("owner type 表示 以付款人身份查看/以收款人身份查看 等")
			.got_page("my profile")
				.comments("个人信息")
				.may_request("start to select working scenario")
		.request("start to select working scenario")
			.comments("切换当前工作场景. 主要是切换job").no_footprint()
			.got_page("working scenario selection")
				.comments("选择工作场景")
				.may_request("select working scenario")
		.request("select working scenario").with_string("assignment id")
			.comments("选择一个工作场景").no_footprint()
			.got_page("my profile")
			
		/** 项目申请 */
		.request("apply to start a new project")
			.comments("申请一个新项目").no_login().no_footprint()
			.got_page("new project application form")
				.comments("填写 新项目申请表")
				.may_request("submit new project application")
		.request("submit new project application").with_form("customer_project_application")
			.comments("提交项目申请").no_login().no_footprint()
			.got_page("simple popup")
				.comments("项目申请 详情")
				// .may_request("cancel") // 申请需要撤销吗? 催促吗? 投诉吗? .....
		.request("view my project application list").with_string("filter")
			.comments("按状态查看我的项目申请列表")
			.query("customer_project_application").which("mine by status").pagination().with_string("filter").with_string("assignment id").with_string("owner type")
				.comments("根据状态查询 新项目申请 的列表")
				.rule_comments("'我'所任职的公司的任何人都应该能够看到项目申请")
				.rule_comments("没有 '本人提交的 就一直可见' 的规定,离职后就不能看到在上一家公司提交的申请")
				.rule_comments("暂不考虑不同的role带来的可见性问题, 所有在一家公司任职的人的'项目申请'的可见性是一样的")
			.got_page("customer project application list").list_of("project_application")
				.comments("我的项目申请列表页面")
				.may_request("view my next page project application list")
				.may_request("view project application detail")
		.request("view my next page project application list").with_string("filter").with_string("last record id")
			.comments("按状态查看我的项目申请列表: 翻页")
			.got_page("customer project application list")
		.request("view project application detail").with_string("application id")
			.comments("查看 项目申请 详情")
			.got_page("project application detail")
				
		/** 项目列表 */
		.request("view my project list").with_string("filter")
			.comments("查看项目列表")
			.query("project").which("user owned").pagination().with_string("filter").with_string("merchant id")
				.comments("根据merchant ID, 查询该merchant作为业主时的所有项目")
				.rule_comments("作为业主公司的任意雇员都可以看得到")
				.rule_comments("作为业主公司的 老板/持有人, 可以看到")
				.rule_comments("按创建时间倒序排列, 即按ID倒序排列")
			.query("project").which("served by merchant").pagination().with_string("filter").with_string("merchant id")
				.comments("根据merchant ID, 查询该merchant作为服务提供商时的所有项目")
				.rule_comments("门店 类型的公司,所有雇员都看得到")
				.rule_comments("品牌商 类型的公司, 所在的工作包在项目内, 就可以看到")
				.rule_comments("按创建时间倒序排列, 即按ID倒序排列")
			
			.got_page("project list").list_of("project")
				.comments("项目列表页面").title("项目列表")
				.may_request("view project detail")
				.may_request("view my next page project list")
		.request("view my next page project list").with_string("filter").with_string("last record id")
			.comments("查看项目列表: 翻页")
			.got_page("project list")
		.request("view project detail").with_string("project id")
			.comments("查看项目详情")
			.query("main_order").which("in project need pay").pagination().with_string("project id").with_boolean("pay to me").with_integer("top n")
				.comments("查询当前项目的待支付订单")
				.rule_comments("作为 业主方 可以看到所有我需要去支付的订单")
				.rule_comments("作为 服务商 可以看到所有需要给我支付的订单")
				.rule_comments("需要我支付还是需要支付给我, 在页面上需要有办法识别出来")
			.got_page("project detail")
				.comments("项目详情")
				
		/** 订单列表 */
		.request("view main order list").with_string("filter")
			.comments("查看订单列表").need_login().has_footprint()
			.query("main_order").which("mine").pagination().with_string("filter").with_string("owner type")
				.comments("根据当前的任职情况,订单状态,视角(暂时不用)搜索主订单")
				.rule_comments("自己下的订单可以看到")
				.rule_comments("admin可以看到本公司其他人下的订单")
				.rule_comments("financial可以看到本公司其他人下的订单")
				.rule_comments("'我要支付'的订单和'等别人支付'的订单, 目前都放在待支付中, 增加'needPay'标志来表示是我要支付的还是要等别人支付的")
			.got_page("main order list").list_of("main_order")
				.comments("主订单列表页面").title("订单列表")
				.may_request("view main order detail")
				.may_request("view next page main order list")
		.request("view next page main order list").with_string("filter").with_string("last record id")
			.comments("查看订单列表").need_login().no_footprint()
			.got_page("main order list")
		.request("view main order detail").with_string("order id")
			.comments("查看订单详情").need_login().has_footprint()
			.got_page("main order detail")
				.comments("主订单详情页")
				.may_request("select payment method")
		.request("select payment method").with_string("order id")
			.comments("为主订单选择支付方式").need_login().no_footprint()
			.got_page("payment method selection")
				.comments("支付方式选择页面")
				.may_request("start to pay main order")
		.request("start to pay main order").with_form("payment option selection")
			.comments("选定了支付选项后, 开始支付.").need_login()
			.when("pay by wechat").comments("需要调用微信支付")
				.got_page("wechat pay integration")
					.comments("微信支付集成页面. 负责使用后台运算的结果信息,调起微信支付")
					.may_request("wechat pay done")
			.when("pay by offline").comments("需要上传支付凭证")
				.got_page("upload offline payment instrument")
					.comments("外部支付时,需要上传支付凭证和备注说明")
					.may_request("offline pay done")
			.when("pay finished").comments("无需其他支付集成,支付已经完成")
				.got_page("pay success")
					.comments("支付完成的提示页面")
		.request("wechat pay done").with_string("order id")
			.comments("微信支付完成通知后台").need_login().no_footprint()
			.got_page("pay success")
		.request("offline pay done").with_string("order id")
			.comments("线下支付信息提交完成通知后台").need_login().no_footprint()
			.got_page("offline payment submitted")
				.comments("线下支付信息提交完成后的提示页面")
				
				
		
		;
		
//			

	@Override
	public PageFlowScript getScript() {
		return SCRIPT;
	}

}
